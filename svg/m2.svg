<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400" width="750" height="333"> <style>  } text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; } .title { font-size: 16px; font-weight: 700; fill: #172B4D; } .subtitle { font-size: 11px; fill: #6B778C; } .state-label { font-size: 10px; font-weight: 600; fill: #FFFFFF; } .state-sublabel { font-size: 8px; fill: rgba(255,255,255,0.85); } .trans-label { font-size: 8.5px; fill: #172B4D; font-weight: 500; } .state1 { opacity: 1;   } .state2 { opacity: 1;   } .state3 { opacity: 1;   } .state4 { opacity: 1;   } .state5 { opacity: 1;   } .state6 { opacity: 1;   } .state7 { opacity: 1;   } .state8 { opacity: 1;   } .arrow12 { stroke-dasharray: 60; stroke-dashoffset: 0;   } .arrow23 { stroke-dasharray: 60; stroke-dashoffset: 0;   } .arrow34 { stroke-dasharray: 80; stroke-dashoffset: 0;   } .arrow35 { stroke-dasharray: 100; stroke-dashoffset: 0;   } .arrow56 { stroke-dasharray: 80; stroke-dashoffset: 0;   } .arrow67 { stroke-dasharray: 100; stroke-dashoffset: 0;   } .arrow74 { stroke-dasharray: 150; stroke-dashoffset: 0;   } .arrow76 { stroke-dasharray: 120; stroke-dashoffset: 0;   } .arrow48 { stroke-dasharray: 60; stroke-dashoffset: 0;   } .label12 { opacity: 1;   } .label23 { opacity: 1;   } .label34 { opacity: 1;   } .label35 { opacity: 1;   } .label56 { opacity: 1;   } .label67 { opacity: 1;   } .label74 { opacity: 1;   } .label76 { opacity: 1;   } .label48 { opacity: 1;   } .happy-highlight { opacity: 1;   } .pulse-active {   transform-origin: center; }  to { opacity: 1; } }  }  }  }  }  50% { transform: scale(1.02); } }  30% { opacity: 0.6; } 70% { opacity: 0.6; } 100% { opacity: 0.35; } }  100% { stroke-dashoffset: -20; } } .retry-loop-anim { stroke-dasharray: 10,5;   } </style> <defs> <marker id="arrDefault" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"> <path d="M0,0 L7,2.5 L0,5 Z" fill="#6B778C"/> </marker> <marker id="arrGreen" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"> <path d="M0,0 L7,2.5 L0,5 Z" fill="#36B37E"/> </marker> <marker id="arrRed" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"> <path d="M0,0 L7,2.5 L0,5 Z" fill="#FF5630"/> </marker> <marker id="arrAmber" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"> <path d="M0,0 L7,2.5 L0,5 Z" fill="#FFAB00"/> </marker> </defs> <rect width="750" height="333" fill="#FAFBFC" rx="8"/> <text x="450" y="28" text-anchor="middle" class="title">M2 - 보상 트랜잭션 상태 전이</text> <text x="450" y="44" text-anchor="middle" class="subtitle">Section 2.1 — State Machine Diagram</text> <g class="happy-highlight"> <path d="M 55 110 L 185 110 L 310 110 L 460 110 L 460 110 L 810 110" stroke="#36B37E" stroke-width="38" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.15"/> </g> <g class="state1"> <rect x="20" y="80" width="120" height="56" rx="10" fill="#0052CC" stroke="#003D99" stroke-width="1.5"/> <circle cx="30" cy="90" r="5" fill="none" stroke="#FFF" stroke-width="1.5"/> <circle cx="30" cy="90" r="2" fill="#FFF"/> <text x="80" y="104" text-anchor="middle" class="state-label">REDIS_ISSUED</text> <text x="80" y="116" text-anchor="middle" class="state-sublabel">Redis 발급 기록 완료</text> <text x="80" y="128" text-anchor="middle" style="font-size:7px; fill:rgba(255,255,255,0.6);">시작 상태</text> </g> <g class="state2"> <rect x="195" y="80" width="120" height="56" rx="10" fill="#FF5630" stroke="#DE350B" stroke-width="1.5"/> <text x="255" y="104" text-anchor="middle" class="state-label">DB_INSERT</text> <text x="255" y="114" text-anchor="middle" class="state-label">_FAILED</text> <text x="255" y="128" text-anchor="middle" class="state-sublabel">DB 쓰기 실패</text> </g> <g class="state3"> <rect x="370" y="80" width="130" height="56" rx="10" fill="#FFAB00" stroke="#FF991F" stroke-width="1.5"/> <text x="435" y="104" text-anchor="middle" class="state-label" style="fill:#172B4D;">COMPENSATING</text> <text x="435" y="118" text-anchor="middle" class="state-sublabel" style="fill:rgba(0,0,0,0.6);">compensate.lua 실행 중</text> </g> <g class="state4 pulse-active"> <rect x="560" y="80" width="120" height="56" rx="10" fill="#36B37E" stroke="#2D9F6F" stroke-width="1.5"/> <text x="620" y="104" text-anchor="middle" class="state-label">COMPENSATED</text> <text x="620" y="118" text-anchor="middle" class="state-sublabel">Redis 원복 성공</text> </g> <g class="state5"> <rect x="350" y="200" width="145" height="56" rx="10" fill="#BF2600" stroke="#8C1D00" stroke-width="1.5"/> <text x="422" y="222" text-anchor="middle" class="state-label" style="font-size:9px;">COMPENSATION</text> <text x="422" y="234" text-anchor="middle" class="state-label" style="font-size:9px;">_FAILED</text> <text x="422" y="248" text-anchor="middle" class="state-sublabel">Redis 원복 실패</text> </g> <g class="state6"> <rect x="545" y="200" width="130" height="56" rx="10" fill="#FFAB00" stroke="#FF991F" stroke-width="1.5"/> <text x="610" y="220" text-anchor="middle" class="state-label" style="fill:#172B4D; font-size:9px;">LOGGED_FOR</text> <text x="610" y="232" text-anchor="middle" class="state-label" style="fill:#172B4D; font-size:9px;">_RETRY</text> <text x="610" y="248" text-anchor="middle" class="state-sublabel" style="fill:rgba(0,0,0,0.6);">t_compensation_log 기록</text> </g> <g class="state7"> <rect x="545" y="310" width="130" height="50" rx="10" fill="#FFAB00" stroke="#FF991F" stroke-width="1.5"/> <text x="610" y="334" text-anchor="middle" class="state-label" style="fill:#172B4D;">RETRYING</text> <text x="610" y="348" text-anchor="middle" class="state-sublabel" style="fill:rgba(0,0,0,0.6);">재시도 워커 처리 중</text> </g> <g class="state8"> <rect x="740" y="80" width="120" height="56" rx="10" fill="#36B37E" stroke="#2D9F6F" stroke-width="2"/> <rect x="744" y="84" width="112" height="48" rx="8" fill="none" stroke="#FFF" stroke-width="1" stroke-dasharray="3,2"/> <text x="800" y="104" text-anchor="middle" class="state-label">RESOLVED</text> <text x="800" y="118" text-anchor="middle" class="state-sublabel">최종 정합성 달성</text> <text x="800" y="128" text-anchor="middle" style="font-size:7px; fill:rgba(255,255,255,0.6);">종료 상태</text> </g> <line x1="140" y1="108" x2="193" y2="108" stroke="#6B778C" stroke-width="1.5" marker-end="url(#arrDefault)" class="arrow12"/> <text x="167" y="100" text-anchor="middle" class="trans-label label12">INSERT 예외</text> <line x1="315" y1="108" x2="368" y2="108" stroke="#6B778C" stroke-width="1.5" marker-end="url(#arrDefault)" class="arrow23"/> <text x="342" y="76" text-anchor="middle" class="trans-label label23" style="font-size:7.5px;">compensate.lua</text> <text x="342" y="86" text-anchor="middle" class="trans-label label23" style="font-size:7.5px;">EVALSHA</text> <line x1="500" y1="105" x2="558" y2="105" stroke="#36B37E" stroke-width="2" marker-end="url(#arrGreen)" class="arrow34"/> <g class="label34"> <text x="530" y="97" text-anchor="middle" class="trans-label" style="fill:#36B37E; font-size:7.5px;">INCR+SREM+DEL</text> <text x="530" y="86" text-anchor="middle" class="trans-label" style="fill:#36B37E; font-size:7.5px;">성공</text> </g> <path d="M 435 136 L 435 170 L 422 198" stroke="#FF5630" stroke-width="1.5" fill="none" marker-end="url(#arrRed)" class="arrow35"/> <text x="450" y="170" class="trans-label label35" style="fill:#FF5630;">Redis 통신 실패</text> <line x1="495" y1="228" x2="543" y2="228" stroke="#6B778C" stroke-width="1.5" marker-end="url(#arrDefault)" class="arrow56"/> <g class="label56"> <text x="519" y="218" text-anchor="middle" class="trans-label" style="font-size:7px;">t_compensation_log</text> <text x="519" y="210" text-anchor="middle" class="trans-label" style="font-size:7px;">INSERT</text> </g> <line x1="610" y1="256" x2="610" y2="308" stroke="#6B778C" stroke-width="1.5" marker-end="url(#arrDefault)" class="arrow67"/> <text x="635" y="285" class="trans-label label67">워커 스케줄링</text> <path d="M 620 310 L 620 290 L 720 170 L 650 138" stroke="#36B37E" stroke-width="2" fill="none" marker-end="url(#arrGreen)" class="arrow74"/> <g class="label74"> <text x="700" y="200" class="trans-label" style="fill:#36B37E;">재시도 성공</text> </g> <path d="M 545 335 Q 510 290 545 240" stroke="#FFAB00" stroke-width="2" fill="none" marker-end="url(#arrAmber)" class="arrow76 retry-loop-anim"/> <g class="label76"> <text x="505" y="280" text-anchor="end" class="trans-label" style="fill:#FFAB00; font-size:7.5px;">재시도 실패</text> <text x="505" y="292" text-anchor="end" class="trans-label" style="fill:#FFAB00; font-size:7.5px;">→ 재큐잉</text> </g> <line x1="680" y1="108" x2="738" y2="108" stroke="#36B37E" stroke-width="2" marker-end="url(#arrGreen)" class="arrow48"/> <text x="709" y="100" text-anchor="middle" class="trans-label label48" style="fill:#36B37E; font-size:7.5px;">drift 검증 통과</text> <g transform="translate(20, 360)"> <rect x="0" y="0" width="10" height="10" rx="2" fill="#0052CC"/> <text x="14" y="9" style="font-size:8px; fill:#6B778C;">시작</text> <rect x="50" y="0" width="10" height="10" rx="2" fill="#FF5630"/> <text x="64" y="9" style="font-size:8px; fill:#6B778C;">실패</text> <rect x="95" y="0" width="10" height="10" rx="2" fill="#FFAB00"/> <text x="109" y="9" style="font-size:8px; fill:#6B778C;">처리 중</text> <rect x="150" y="0" width="10" height="10" rx="2" fill="#36B37E"/> <text x="164" y="9" style="font-size:8px; fill:#6B778C;">성공/종료</text> <rect x="210" y="0" width="10" height="10" rx="2" fill="#BF2600"/> <text x="224" y="9" style="font-size:8px; fill:#6B778C;">심각 실패</text> <line x1="290" y1="5" x2="310" y2="5" stroke="#36B37E" stroke-width="3" opacity="0.35"/> <text x="314" y="9" style="font-size:8px; fill:#6B778C;">Happy Path</text> </g> </svg>